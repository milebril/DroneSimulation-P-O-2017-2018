package autopilotModule;

import java.util.HashMap;

import org.lwjgl.util.vector.Matrix4f;
import org.lwjgl.util.vector.Vector3f;

import autopilot.algorithmHandler.AutopilotAlain;
import autopilot.interfaces.AutopilotConfig;
import autopilot.interfaces.AutopilotInputs;
import autopilot.interfaces.AutopilotModule;
import autopilot.interfaces.AutopilotOutputs;
import entities.Drone;
import models.Airport;
import models.RawModel;
import models.TexturedModel;
import physicsEngine.PhysicsEngine;
import physicsEngine.approximationMethods.EulerPrediction;
import renderEngine.Loader;
import renderEngine.OBJLoader;
import textures.ModelTexture;

public class Module implements AutopilotModule{
	
	private static final float STEP_TIME = 0.001f;
	private static Loader loader;
	
	private float length;
	private float width;
	
	private HashMap<Integer,Drone> drones = new HashMap<Integer, Drone>();
	private HashMap<Integer,Airport> airports = new HashMap<Integer, Airport>();
	private HashMap<Integer,AutopilotAlain> autopilots = new HashMap<Integer, AutopilotAlain>();
	
	public Module() {
	};
	

	@Override
	public void defineAirportParams(float length, float width) {
		this.length = length;
		this.width = width;
		
	}

	@Override
	public void defineAirport(float centerX, float centerZ, float centerToRunway0X, float centerToRunway0Z) {
		// (centerToRunway0X, centerToRunway0Z) constitutes a unit vector pointing from the center of the airport towards runway 0
		
	}

	@Override
	public void defineDrone(int airport, int gate, int pointingToRunway, AutopilotConfig config) {
		// airport and gate define the drone's initial location, pointingToRunway its initial orientation. The first drone that is defined is drone 0, etc.
		
		
		
		loader = new Loader();
		RawModel droneModel = OBJLoader.loadObjModel("untitled5", loader);
		TexturedModel staticDroneModel = new TexturedModel(droneModel,
				new ModelTexture(loader.loadTexture("untitled")));
		Drone drone = new Drone(staticDroneModel, new Matrix4f().translate(new Vector3f(0,
				(int) PhysicsEngine.groundLevel - config.getWheelY() + config.getTyreRadius(), 0)),
				1f, config, new EulerPrediction(STEP_TIME));
		drones.put(drones.size(), drone);
	}

	@Override
	public void startTimeHasPassed(int drone, AutopilotInputs inputs) {
		// Allows the autopilots for all drones to run in parallel if desired. Called with drone = 0 through N - 1, in that order, if N drones have been defined.
		autopilots.get(drone).startTimeHasPassed(inputs);
	}

	@Override
	public AutopilotOutputs completeTimeHasPassed(int drone) {
		// Called with drone = 0 through N - 1, in that order, if N drones have been defined.
		
		AutopilotOutputs outputs = autopilots.get(drone).completeTimeHasPassed();
		//drones.get(drone).setAutopilotOutputs(outputs); dees is voor de maingameloop
		return outputs;
	}

	@Override
	public void deliverPackage(int fromAirport, int fromGate, int toAirport, int toGate) {
		// Informs the autopilot module of a new package delivery request generated by the testbed.
		
	}

	@Override
	public void simulationEnded() {
		
		
	}

}
